<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMSDv2</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/icon.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <main>
        <div class="left_box">
            <div class="header_notifications">
                <div class="return">
                    <a href="/"></a>
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 32 32">
                        <path fill="currentColor"
                            d="M20.834 8.037L9.64 14.5c-1.43.824-1.43 2.175 0 3l11.194 6.463c1.43.826 2.598.15 2.598-1.5V9.537c0-1.65-1.17-2.326-2.598-1.5" />
                    </svg>
                </div>
                <div class="scrap_box">
                    <div class="left">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1.05em" height="1em" viewBox="0 0 25 24">
                            <path fill="currentColor"
                                d="M2.226 2h20v9h-20zm6.002 3.5H6.224v2.004h2.004zM2.226 13h20v9h-20zm6.002 3.5H6.224v2.004h2.004z" />
                        </svg>
                    </div>
                    <div class="right">
                        <h4>Last Scrap <b><em><span id="last_scrap">AAAA-MM-DD HH:MM:SS</span></em></b></h3>
                            <p><b><em><span>Result</span></em></b></p>
                    </div>
                </div>
            </div>

            <div class="notifications_list">
                <ul>
                </ul>
            </div>

        </div>
    </main>

</body>

<script>
    // scrap_box
    const scrap_box = document.querySelector(".scrap_box");


    // last_scrap
    let last_scrap = '{{last_scrap | tojson | safe}}';
    console.log("LAST_SCRAP -> ");
    last_scrap = JSON.parse(last_scrap);
    console.log(last_scrap);



    if (last_scrap['last_scrap_result'] == "ok") {
        scrap_box.classList.add("ok");
        scrap_box.querySelector(".right p span").innerHTML = "The last scrap has been successfully completed!"
    }

    if (last_scrap['last_scrap_result'] == "ko") {
        scrap_box.classList.add("ko");
        scrap_box.querySelector(".right p span").innerHTML = "The last scrap has failed!"
        scrap_box.querySelector(".right").innerHTML += `
        <details>
            <summary>See more</summary>
            <p>
                ${last_scrap['last_scrap_result']} -> Debug message: <span>${last_scrap['attributes']['result_reason']}</span> at <span>${last_scrap['last_scrap']}</span>
            </p>
        </details>
        `;
    }

    scrap_box.querySelector(".right h4 span").innerHTML = last_scrap['last_scrap'];

</script>

<script>
    // notifications
    let notifications = '{{notifications | tojson | safe}}';
    console.log("NOTIFICATIONS -> ");
    notifications = JSON.parse(notifications);
    console.log(notifications);

    // notifications
    notifications.forEach(notification => {
        const notifications_list = document.querySelector(".notifications_list ul");

        let icon = "";

        switch (notification['attributes']['type']) {
            case "ko":
                icon = `<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48"><path fill="currentColor" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="m6 11l5-5l13 13L37 6l5 5l-13 13l13 13l-5 5l-13-13l-13 13l-5-5l13-13z" clip-rule="evenodd"/></svg>`;
                break;
            case "ok":                
                icon = `<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 1200 1200"><path fill="currentColor" d="m1004.237 99.152l-611.44 611.441l-198.305-198.305L0 706.779l198.305 198.306l195.762 195.763L588.56 906.355L1200 294.916z"/></svg>`;
                break;
            default:
                icon = `<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.495 3.25H8.5a.75.75 0 0 0 0 1.5h.26v5.087a7.25 7.25 0 0 1-1.256 4.078l-3.093 4.548a1.855 1.855 0 0 0 1.326 2.887l.087.01l.017.002c4.093.46 8.225.46 12.318 0l.018-.002l.086-.01a1.855 1.855 0 0 0 1.326-2.887l-3.093-4.548a7.25 7.25 0 0 1-1.256-4.078V4.75h.26a.75.75 0 0 0 0-1.5zm-4.666 9.3h4.342a8.8 8.8 0 0 1-.43-2.713V4.75H10.26v5.087a8.8 8.8 0 0 1-.431 2.713M10 17a1 1 0 1 0 0 2a1 1 0 0 0 0-2m2-1a1 1 0 1 1 2 0a1 1 0 0 1-2 0" clip-rule="evenodd"/></svg>`;
                break;
        }

        notifications_list.innerHTML += `
            <li class="${notification['attributes']['type']}">
                <div class="left">
                    ${icon}
                </div>
                <div class="right">
                    <h3>${notification['attributes']['title']} <span>${notification['notification_date']}</span></h3>
                    <p><b><em><span>${notification['attributes']['message']}</span></em></b></p>
                </div>
            </li>
        `
    })
</script>


</html>